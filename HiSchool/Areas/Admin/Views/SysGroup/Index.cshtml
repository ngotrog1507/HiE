
@using Core.Ultity

@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
    var isHost = ViewBag.Host != null && (bool)ViewBag.Host;
}
<div class="_modal">
    <div class="cssload-container">
        <div class="cssload-speeding-wheel"></div>
        <div id="veil"></div>
    </div>
</div>
<!-- Content Header (Page header) -->
<section class="content-header">

    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i>Quản lý nhóm</a></li>
    </ol>
</section>

<!-- Main content -->
<section class="content">
    <div class="row"></div>
    <div class="row">
        <div class="col-md-12">
            <!-- Horizontal Form -->
            <div class="box box-success">
                <div class="box-header with-border">
                    <h3 class="box-title">Tìm kiếm </h3>
                </div>
                <!-- /.box-header -->
                <!-- form start -->
                <div class="form-horizontal">
                    <div class="box-body">
                        <div class="row">
                            <div class="form-group col-sm-1"></div>
                            <div class="form-group col-sm-5">
                                <label class="col-sm-3 control-label">Tên nhóm</label>

                                <div class="col-sm-9">
                                    <input type="text" id="Key" name="key" class="form-control " placeholder="Tên nhóm">
                                    @* @Html.TextBox("Key", (string)ViewBag.Search, new { @placeholder = "", @maxlength = "300", @class = "form-control" })*@
                                </div>
                            </div>

                            <div class="form-group col-sm-5">
                                <label class="col-sm-3 control-label">Trạng thái</label>
                                <div class="col-sm-9">
                                    @if (ViewBag.UsedState != null)
                                    {
                                        @Html.DropDownList("UsedState", ViewBag.UsedState as SelectList, null, new { @class = "js-select2-clear col-sm-12" })
                                    }
                                    @*<select class="js-select2 col-sm-12" name="state" placeholder="Chọn ">
                                            <option value="AL">Alabama</option>
                                            <option value="AL">Alabama2</option>
                                            <option value="WY">Wyoming</option>
                                        </select>*@
                                    @*<ui-select >
                                            <ui-select-match allow-clear="true" placeholder=".....Chọn.....">$select.selected.name</ui-select-match>
                                            <ui-select-choices repeat="record in stateList | filter: $select.search">
                                                <div ng-bind-html="record.name | highlight: $select.search"></div>
                                            </ui-select-choices>
                                        </ui-select>'*@
                                </div>
                            </div>
                            <div class="form-group col-sm-1"></div>
                        </div>
                        <div class="form-group col-sm-12" style="text-align: center;">
                            <button type="button" title="Tìm kiếm" class="btn color-trong btn-trong" onclick=" refresh(currentPage) ">
                                <i class="fa fa-search" aria-hidden="true"></i>&nbsp;&nbsp;Tìm kiếm
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="box box-success">
                <div class="box-header with-border" style="padding-bottom: 0px;">
                    <div class="col-sm-6">
                        <h3 class="box-title" style="margin-left: -18px;"> Danh sách</h3>
                    </div>
                    <!--trongnv-->
                    <div class="col-sm-6">
                        @if ((ViewBag.Delete != null && (bool)ViewBag.Delete) || isHost)
                        {
                            <button type="submit" style="margin: -8px -14px 4px 19px;" title="Xóa" class="btn btn-danger pull-right" onclick=" DeleteAll(null, '@Url.Action("Delete", "SysGroup")' ) ">
                                <i class="fa fa-times-circle" aria-hidden="true"></i>&emsp; Xóa &emsp;
                            </button>
                        }
                        @if ((ViewBag.Add != null && (bool)ViewBag.Add) || isHost)
                        {
                            <button type="submit" style="margin: -8px -14px 4px 19px;" title="Thêm mới" class="btn btn-success pull-right" onclick=" AddRecord() ">
                                <i class="fa fa-plus-circle" aria-hidden="true"></i>&nbsp;&nbsp;Thêm mới
                            </button>
                        }
                    </div>
                </div>
                <!-- /.box-header -->
                <!-- form start -->
                <form class="form-horizontal">
                    <div class="box-body">
                        <div id="example1_wrapper" class="dataTables_wrapper form-inline dt-bootstrap">
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="dataTables_length">
                                        <label>
                                            Số lượng hiển thị
                                            <select name="example1_length" id="sizePage" onchange=" refresh(currentPage) " aria-controls="example1" class="selectOption-trong form-control input-sm">
                                                <option value="10">10</option>
                                                <option value="20">20</option>
                                                <option value="50">50</option>
                                                <option value="100">100</option>
                                            </select>
                                            bản ghi
                                        </label>
                                    </div>
                                </div>
                                <div class="col-sm-6"></div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12">
                                    <table id="example1" class="table table-bordered table-striped">
                                        <thead class="color-trong">
                                            <tr>
                                                <th style="width: 2%; text-align: center">
                                                    <span><input type="checkbox" onclick=" CheckAll() " class="ace check-all" data-id="0" /></span>
                                                </th>
                                                <th style="width: 5%; text-align: center">STT</th>
                                                <th style="width: 5%; text-align: center">CN</th>
                                                <th style="width: 30%; text-align: center">Tên nhóm</th>
                                                <th style="text-align: center">Ngày tạo</th>
                                                <th style="text-align: center">Người tạo</th>
                                                <th style="text-align: center">Trạng thái</th>
                                                <th style="text-align: center; width: 15%;">Người dùng</th>
                                            </tr>
                                        </thead>
                                        <tbody id="data"></tbody>
                                    </table>
                                </div>
                            </div>
                            <div id="paging"></div>
                            @*  @Html.Raw(MvcPagingByFrameWork.Paging(Model.PageCount, Model.PageIndex, "System/SysGroup/Index", ViewBag.Search))*@
                        </div>
                    </div>
                </form>
                <div class="modal fade" id="modal-default">
                    <div class="modal-dialog" style="width: 63%">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <h4 class="modal-title">Thông tin nhóm</h4>
                                <input type="hidden" id="txtId" />
                            </div>
                            <div class="modal-body">
                                <form class="form-horizontal2">
                                    <div class="row">
                                        <div class="form-group col-sm-6">
                                            <label class="col-sm-4 control-label">Tên nhóm</label>

                                            <div class="col-sm-8">
                                                <div class="clearfix">
                                                    <input type="text" id="Name" name="Name" class="form-control " placeholder="Tên nhóm">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group col-sm-5">
                                            <label class="col-sm-4 control-label">Trạng thái</label>
                                            <div class="col-sm-8">
                                                @if (ViewBag.UsedState != null)
                                                {
                                                    @Html.DropDownList("UsedStateAdd", ViewBag.UsedStateAdd as SelectList, null, new { @class = "js-select2 col-sm-12" })
                                                }
                                            </div>
                                        </div>
                                        <div class="form-group col-sm-1"></div>
                                    </div>
                                    <div class="row">
                                        <div class="form-group col-sm-11">
                                            <label class="col-sm-2 control-label">Mô tả</label>
                                            <div class="col-sm-10" id="summary">
                                                @*<input type="text" class="summary-wysi" placeholder="Nội dung mô tả/>*@
                                                <textarea class="textarea summary-wysi" placeholder="Nội dung mô tả"
                                                          style="width: 100%; height: 200px; font-size: 14px; line-height: 18px; border: 1px solid #dddddd; padding: 10px;"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Đóng</button>
                                <button type="button" class="btn btn-success" id="btnAdd" onclick=" Save('add') "><i class="fa fa-save" aria-hidden="true"></i>&nbsp; Lưu &nbsp;</button>
                                <button type="button" class="btn btn-primary" id="btnEdit" onclick=" Save('edit') "><i class="fa fa-save" aria-hidden="true"></i>&nbsp; Lưu &nbsp;</button>
                            </div>
                        </div>
                        <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                </div>
                <div class="modal fade" id="modal-list-user">
                    <div class="modal-dialog" style="width: 90%">

                        <div class="modal-content">
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="box box-success">
                                            <div class="box-header with-border">
                                                <h3 class="box-title">Danh sách tài khoản trong nhóm </h3>
                                            </div>
                                            <!-- /.box-header -->
                                            <!-- form start -->
                                            <form class="form-horizontal">
                                                <div class="box-body">

                                                    <div class="row">
                                                        <div class="form-group col-sm-1"></div>
                                                        <div class="form-group col-sm-6">
                                                            <label class="col-sm-4 control-label">Tên người dùng</label>

                                                            <div class="col-sm-8">
                                                                <input type="text" id="txtName" class="form-control " placeholder="Tên người dùng">
                                                                <input type="hidden" id="txtGroupId">
                                                            </div>
                                                        </div>

                                                        <div class="form-group col-sm-5">
                                                            <button type="button" onclick=" loadUserInGroup() " title="Tìm kiếm" class="btn color-trong btn-trong tableLDelete">
                                                                <i class="fa fa-search" aria-hidden="true"></i>&nbsp;&nbsp;Tìm kiếm
                                                            </button>
                                                            <button type="button" onclick="loadUserNotInGroup()" title="Tìm kiếm" class="btn color-trong btn-trong tableList">
                                                                <i class="fa fa-search" aria-hidden="true"></i>&nbsp;&nbsp;Tìm kiếm
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="box box-success">
                                            <div class="box-header with-border" style="padding-bottom: 0px;">
                                                <div class="col-sm-6">
                                                    <h3 class="box-title" style="margin-left: -18px;">Danh sách bản ghi</h3>
                                                </div>
                                                <!--trongnv-->
                                            </div>
                                            <!-- Horizontal Form -->
                                            <form class="form-horizontal">
                                                <div class="box-body scoll-box-body">
                                                    <div id="example1_wrapper2" class="dataTables_wrapper form-inline dt-bootstrap">
                                                        <div class="row">
                                                            <div class="col-sm-12">
                                                                <table class="table table-bordered table-striped">
                                                                    <thead class="color-trong">
                                                                        <tr>
                                                                            <th class="tableList" style="width: 2%; text-align: center">
                                                                                <span> <input type="checkbox" onclick="CheckAllShow() " class="ace check-all-show"></span>
                                                                            </th>
                                                                            <th style="width: 5%; text-align: center">STT</th>
                                                                            <th style="width: 20%; text-align: center">Tên người dùng</th>
                                                                            <th style="text-align: center">Tài khoản</th>
                                                                            <th style="text-align: center">Email</th>
                                                                            <th style="text-align: center; width: 10%;">Host</th>
                                                                            <th style="text-align: center">Ngày tạo</th>
                                                                            <th style="text-align: center">Trạng thái</th>
                                                                            <th class="tableLDelete" style="text-align: center">Xóa</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody id="rptListUser"></tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-horizontal">
                                                    <div class="box-body">
                                                        <div class="row modal-footer" style="text-align: center;">
                                                            <button type="button" title="Lưu" class="btn btn-success  tableList" onclick="SaveShow()" style="margin-right: 8px;">
                                                                <i class="fa fa-save" aria-hidden="true"></i>&emsp;Lưu &emsp;
                                                            </button>
                                                            <button title="Quay lại" class="btn btn-danger" data-dismiss="modal">
                                                                <i class="fa fa-reply"></i>&nbsp;Quay lại
                                                            </button>

                                                        </div>
                                                    </div>
                                                </div>
                                            </form>

                                        </div>
                                        <!-- /.box -->
                                        <!-- general form elements disabled -->
                                        <!-- /.box -->
                                    </div>
                                    <!--/.col (right) -->
                                    <!-- /.content -->
                                </div>


                            </div>
                        </div>
                    </div>
                    <!-- /.box -->
                    <!-- general form elements disabled -->
                    <!-- /.box -->
                </div>
            </div>
        </div>
    </div>
</section>
<!--/.col (right) -->
<!-- /.content -->
@section jsFooter{
    <script>
        $('.form-horizontal2').validate({
            errorElement: 'div',
            errorClass: 'help-block',
            focusInvalid: false,
            ignore: "",
            rules: {
                Name: {
                    required: true
                }
            },

            messages: {
                Name: {
                    required: "Trường này không được bỏ trống ."
                }
            },

            highlight: function(e) {
                $(e).closest('.form-group').removeClass('has-info').addClass('has-error');
            },

            success: function(e) {
                $(e).closest('.form-group').removeClass('has-error'); //.addClass('has-info');
                $(e).remove();
            },

            errorPlacement: function(error, element) {
                if (element.is('input[type=checkbox]') || element.is('input[type=radio]')) {
                    var controls = element.closest('div[class*="col-"]');
                    if (controls.find(':checkbox,:radio').length > 1) controls.append(error);
                    else error.insertAfter(element.nextAll('.lbl:eq(0)').eq(0));
                } else if (element.is('.select2')) {
                    error.insertAfter(element.siblings('[class*="select2-container"]:eq(0)'));
                } else if (element.is('.chosen-select')) {
                    error.insertAfter(element.siblings('[class*="chosen-container"]:eq(0)'));
                } else error.insertAfter(element.parent());
            }

            //submitHandler: function (form) {

            //},
            //invalidHandler: function (form) {
            //}
        });
    </script>
    <script>
        refresh(currentPage);

        function refresh(page) {
            $("._modal").show();
            var sData = "{'page':'" + page + "','key':'" + $("#Key").val() + "','sort':'','usedState':'" + $('#UsedState').find(":selected").val() + "','pageSize':'" + $("#sizePage").find(":selected").val() + "'}";
            $.ajax({
                type: "POST",
                url: '@Url.Action("GetData", "SysGroup")',
                data: sData,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function(response) {
                    $("._modal").hide();
                    if (response.status == "success") {
                        console.log(response);
                        var listData = response.Data;
                        var totalRecord = response.TotalPage;
                        var pageSize = response.PageSize;
                        var totalPage = (totalRecord % pageSize != 0) ? Math.floor(totalRecord / pageSize) + 1 : Math.floor(totalRecord, pageSize);
                        var currentPage = response.CurrentPage;
                        var str = "";
                        var roleDelete = ('@ViewBag.Delete' === 'True');
                        var roleEdit = ('@ViewBag.Edit' === 'True');
                        listData.forEach(function(item, index) {
                            str += "<tr style=\"text-align: center\">";
                            str += "                        <td style=\"text-align: center\">";
                            str += "<input type=\"checkbox\" name=\"check-row\" class=\"ace check-row\" data-id="+item.Id+">";
                            str += "</td>";
                            str += "         <td>" + (pageSize * currentPage + index + 1) + "</td>";
                            str += "<td>";
                            str += "              <div class=\"btn-group\">";
                            if (('@ViewBag.Host' === 'True')) {
                                str += "<button type=\"button\" class=\"btn color-trong dropdown-toggle\" style=\"color: white;\" data-toggle=\"dropdown\" aria-expanded=\"false\">";
                                str += "<i class=\"fa fa-cog\" aria-hidden=\"true\"></i>";
                                str += "</button>";

                                str += " <ul class=\"dropdown-menu setting-menu\" role=\"menu\">";
                                str += "<li onclick=\"EditRecord(" + item.Id + ")\"><a class=\"noClick\" href=\"\"><i class=\"fa fa-pencil-square-o\" aria-hidden=\"true\" ></i>Chỉnh sửa</a></li>";
                                str += "<li class=\"divider\"></li>";
                                str += "<li onclick=\"DeleteItem(" + item.Id + ")\"><a class=\"noClick\" href=\"\"><i class=\"fa fa-times-circle\" aria-hidden=\"true\"></i>Xóa</a></li>";
                            } else {
                                if (item.CreatedBy == @WebSecurity.CurrentUserId) {
                                    str += "<button type=\"button\" class=\"btn color-trong dropdown-toggle\" style=\"color: white;\" data-toggle=\"dropdown\" aria-expanded=\"false\">";
                                str += "<i class=\"fa fa-cog\" aria-hidden=\"true\"></i>";
                                str += "</button>";
                                str += "             <ul class=\"dropdown-menu setting-menu\" role=\"menu\">";
                                if (roleEdit != null && roleEdit && roleDelete != null && roleDelete) {
                                    str += "<li onclick=\"EditRecord(" + item.Id + ")\"><a class=\"noClick\" href=\"\"><i class=\"fa fa-pencil-square-o\" aria-hidden=\"true\" ></i>Chỉnh sửa</a></li>";
                                    str += "<li class=\"divider\"></li>";
                                    str += "<li onclick=\"DeleteItem(" + item.Id + ")\"><a class=\"noClick\" href=\"\"><i class=\"fa fa-times-circle\" aria-hidden=\"true\"></i>Xóa</a></li>";
                                } else if (roleEdit != null && roleEdit) {
                                    str += "<li onclick=\"EditRecord(" + item.Id + ")\"><a class=\"noClick\" href=\"\"><i class=\"fa fa-pencil-square-o\" aria-hidden=\"true\" ></i>Chỉnh sửa</a></li>";
                                } else if (roleDelete != null && roleDelete) {
                                    str += "<li onclick=\"DeleteItem(" + item.Id + ")\"><a class=\"noClick\" href=\"\"><i class=\"fa fa-times-circle\" aria-hidden=\"true\"></i>Xóa</a></li>";
                                }
                                str += "</ul>";
                            }
                        }
                            str += "             </div>";
                        str += "</td>";
                        str += "         <td style=\"text-align: left; padding-left: 40px;\">";
                        str += item.Name;
                        str += "    </td>";
                        var date = new Date(parseInt(item.CreatedDate.replace(/(^.*\()|([+-].*$)/g, '')));
                        var dateString = (date.getMonth() + 1) + '/' + date.getDate() + '/' + date.getFullYear();
                        str += "     <td>" + dateString + "</td>";
                        str += "<td>" + item.CreatedByName + "</td>";
                        if (item.UsedState == 1) {
                            str += "<td  title='Đang hoạt động'><span class='badge label-success'><i class='fa fa-fw fa-check-circle'></i></span></td>";
                        } else if (item.UsedState == 0) {
                            str += "<td  title='Đang bị khóa'><span class='badge label-warning'><i class='fa fa-fw fa-check-circle'></i></span></td>";
                        } else {
                            str += "<td  title='Yêu cầu xóa'><span class='badge label-danger'><i class='fa fa-fw fa-check-circle'></i></span></td>";
                        }
                        str += "<td>";
                        str += "              <a href=\"\" class=\"noClick\" onclick=\"listUser(" + item.Id + ")\"><i class=\"fa fa-users\" aria-hidden=\"true\" title=\"Danh sách người dùng\"></i>&nbsp</a>";
                        str += "<a href=\"\" class=\"noClick\" onclick=\"addUser(" + item.Id + ")\"><i class=\"fa fa-user-plus\" aria-hidden=\"true\" title=\"Thêm mới người dùng\"></i>&nbsp</a>";
                        str += "</td>";
                        str += "     </tr>";
                    });
                    $("#data").html(str);
                    console.log(paging(totalPage, page, $("#Key").val()))
                    $("#paging").html(paging(totalPage, page, $("#Key").val()));
                    $('a.noClick').on('click', function(e) {
                        e.preventDefault();
                        //do other stuff when a click happens
                    });
                }

                //window.location.href = url;
            },
                error: function() {
                    ToastMessage("error", "Xảy ra lỗi !");
                }
        });
        }
    </script>
    <script>
        function loadUserInGroup() {
            var groupId = $("#txtGroupId").val();
            $.ajax({
                type: "POST",
                url: '@Url.Action("GetListUser", "SysGroup")',
                data: "{'groupId':'" + groupId + "','name':'" + $("#txtName").val() + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function(msg) {
                    if (msg.status == "success") {
                        var listData=msg.Data;
                        var str = "";
                        listData.forEach(function(item, index) {
                            str += " <tr style=\"text-align: center\">";
                            str += " <td>"+(index+1)+"</td>";
                            str += " <td style=\"text-align: left; padding-left: 40px;\">";
                            str += item.FullName;
                            str += " </td>";
                            str += " <td style=\"text-align: left; padding-left: 40px;\">";
                            str += item.UserName;
                            str += " </td>";
                            str += " <td style=\"text-align: left; padding-left: 40px;\">";
                            str += item.Email;
                            str += " </td>";
                            str += " <td style=\"text-align: center;\">";
                            if (item.Host) {
                                str += "     <i  class=\"fa fa-child\" aria-hidden=\"true\"></i>";
                            }
                            str += " </td>";
                            var date = new Date(parseInt(item.CreatedDate.replace(/(^.*\()|([+-].*$)/g, '')));
                            var dateString = (date.getMonth() + 1) + '/' + date.getDate() + '/' + date.getFullYear();
                            str += "     <td>" + dateString + "</td>";
                            if (item.UsedState == 1) {
                                str += "<td  title=\"Đang hoạt động\"><i class=\"fa fa-lg fa-unlock\"></i></td>";
                            } else if (item.UsedState == 0) {
                                str += "<td  title=\"Đang bị khóa\"><i class=\"fa fa-lg fa-lock\"></i></td>";
                            } else {
                                str += "<td  title=\"Yêu cầu xóa\"><i class=\"fa fa-lg fa-ban\"></i></td>";
                            }
                            str += " <td ng-show=\"action=='list'\">";
                            str += "     <a href=\"\" onclick=\"deleteUser("+item.UserId+")\" class=\"noClick\"><i class=\"fa fa-window-close-o k\" aria-hidden=\"true\" title=\"Xóa người dùng\"></i>&nbsp</a>";
                            str += " </td>";
                            str += "</tr>";
                        });
                        $("#rptListUser").html(str);
                        $('a.noClick').on('click', function(e) {
                            e.preventDefault();
                            //do other stuff when a click happens
                        });
                    } else
                        ToastMessage("error", "Xảy ra lỗi !");
                }
            });
        }
        function deleteUser(id) {
            if(confirm('Bạn có muốn xóa người dùng này khỏi nhóm ???')){
                var groupId = $("#txtGroupId").val();
                var sData = "{'groupId':'" + groupId + "','userId':'" + id + "'}";
                $.ajax({
                    type: "POST",
                    url: '/System/SysGroup/DeleteGroupUser',
                    data: sData,
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (response) {
                        if (response.status == "success") {
                            ToastMessage("success", "Xóa thành công !");
                            loadUserInGroup();
                        }else{
                            ToastMessage("error", "Xảy ra lỗi !");
                        }
                        //window.location.href = url;
                    },
                    error: function () {
                        ToastMessage("error", "Xảy ra lỗi !");
                    }
                });
            }
        }
        function loadUserNotInGroup() {
            var groupId = $("#txtGroupId").val();
            $.ajax({
                type: "POST",
                url: '@Url.Action("GetListUserOutGroup", "SysGroup")',
                data:   "{'groupId':'" + groupId + "','name':'" + $("#txtName").val() + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function(msg) {
                    if (msg.status == "success") {
                        var listData=msg.Data;
                        var str = "";
                        listData.forEach(function(item, index) {
                            str += " <tr style=\"text-align: center\">";
                            str+="<td style=\"text-align: center\">";
                            str+="    <input type=\"checkbox\" data-id="+item.UserId+" class=\"check-item-show\">";
                            str += "   </td>";

                            str += " <td>"+(index+1)+"</td>";
                            str += " <td style=\"text-align: left; padding-left: 40px;\">";
                            str += item.FullName;
                            str += " </td>";
                            str += " <td style=\"text-align: left; padding-left: 40px;\">";
                            str += item.UserName;
                            str += " </td>";
                            str += " <td style=\"text-align: left; padding-left: 40px;\">";
                            str += item.Email;
                            str += " </td>";
                            str += " <td style=\"text-align: center;\">";
                            if (item.Host) {
                                str += "     <i  class=\"fa fa-child\" aria-hidden=\"true\"></i>";
                            }

                            str += " </td>";
                            var date = new Date(parseInt(item.CreatedDate.replace(/(^.*\()|([+-].*$)/g, '')));
                            var dateString = (date.getMonth() + 1) + '/' + date.getDate() + '/' + date.getFullYear();
                            str += "     <td>" + dateString + "</td>";
                            if (item.UsedState == 1) {
                                str += "<td  title=\"Đang hoạt động\"><i class=\"fa fa-lg fa-unlock\"></i></td>";
                            } else if (item.UsedState == 0) {
                                str += "<td  title=\"Đang bị khóa\"><i class=\"fa fa-lg fa-lock\"></i></td>";
                            } else {
                                str += "<td  title=\"Yêu cầu xóa\"><i class=\"fa fa-lg fa-ban\"></i></td>";
                            }
                            str += "</tr>";
                        });
                        $("#rptListUser").html(str);
                    } else
                        ToastMessage("error", "Xảy ra lỗi !");
                }
            });
        }
        function addUser(id) {
            $("#txtName").val("");
            $(".tableList").show();
            $(".tableLDelete").hide();
            $("#modal-list-user").modal();
            $("#txtGroupId").val(id);
            loadUserNotInGroup();
        }
        function listUser(id) {
            $("#txtName").val("");
            $("#txtGroupId").val(id);
            $(".tableList").hide();
            $(".tableLDelete").show();
            $("#modal-list-user").modal();

            loadUserInGroup();

        }
        function SaveShow() {
            var selected = [];
            $('.check-item-show').each(function () {
                if ($(this).is(":checked"))
                    selected.push($(this).attr('data-id'));
            });
            console.log(selected);
            var sData = "{'groupId':'" + $("#txtGroupId").val() + "','user':'" + selected + "'}";
            $.ajax({
                type: "POST",
                url: '/System/SysGroup/SaveGroupUser',
                data: sData,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    if (response.status == "success") {
                        ToastMessage("success", "Lưu thành công !");
                        $("#modal-list-user").modal('hide');
                    }else{
                        ToastMessage("error", "Xảy ra lỗi !");
                    }
                    //window.location.href = url;
                },
                error: function () {
                    ToastMessage("error", "Xảy ra lỗi !");
                }
            });
        }

    </script>
    <script>
        function Reset() {
            $("#summary").html("<textarea class=\"textarea summary-wysi\" placeholder=\"Nội dung mô tả\"" +
                "style=\"width: 100%; height: 200px; font-size: 14px; line-height: 18px; border: 1px solid #dddddd; padding: 10px;\"></textarea>");
            $(".summary-wysi").wysihtml5();
            $("#Name").val("");
            $("#UsedStateAdd").val(1).change();
        }

        function DeleteItem(id) {
            if (confirmDelete()) {
                ajax_delete(id, '@Url.Action("Delete", "SysGroup")');
            }
        }

        function Save(type) {
            if ($('.form-horizontal2').valid()) {
                var data = new Object();
                data.Id = $("#txtId").val();
                data.Summary = $(".summary-wysi").val();
                data.Name = $("#Name").val();
                data.UsedState = $("#UsedStateAdd").find(":selected").val();

                var json = JSON.stringify(data);

                $.ajax({
                    type: "POST",
                    url: '@Url.Action("Edit", "SysGroup")',
                    data: json,
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function(msg) {
                        if (msg.status == "success") {
                            if (type == 'add')
                                ToastMessage("success", "Thêm mới thành công !");
                            else ToastMessage("success", "Sửa thành công !");
                            $("#modal-default").modal('hide');
                            refresh(currentPage);
                        } else
                            ToastMessage("error", "Xảy ra lỗi !");
                    }
                });
            }
        }

        function EditRecord(id) {
            $("#modal-default").modal();
            $("#btnAdd").hide();
            $("#btnEdit").show();
            $.ajax({
                type: "POST",
                url: '@Url.Action("GetById", "SysGroup")',
                data: "{'id':'" + id + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function(msg) {
                    if (msg.status == "success") {
                        $("#summary").html("<textarea class=\"textarea summary-wysi\" placeholder=\"Nội dung mô tả\"" +
                            "style=\"width: 100%; height: 200px; font-size: 14px; line-height: 18px; border: 1px solid #dddddd; padding: 10px;\">" + msg.Data.Summary + "</textarea>");
                        $(".summary-wysi").wysihtml5();
                        $("#Name").val(msg.Data.Name);
                        $("#txtId").val(msg.Data.Id);
                        $("#UsedStateAdd").val(msg.Data.UsedState).change();
                    } else
                        ToastMessage("error", "Xảy ra lỗi !");
                }
            });
        }


    </script>
}

