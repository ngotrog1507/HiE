function initTinyMce(selector)
{tinymce.init({menubar:false,selector:selector,mode:"specific_textareas",editor_selector:selector,entity_encoding:"raw",plugins:["eqneditor charmap textcolor colorpicker paste"],toolbar:["undo redo | eqneditor charmap | superscript subscript | bold underline italic |  removeformat "],language:'vi',paste_as_text:true,});}
jQuery(document).ready(function(){$('#tp-examControl ul li a').click(function(){$('.message-choice').addClass('hidden');});removeOptionType();function removeOptionType()
{var subject=$('[name=subject]').val();var cls=$('[name=class]').val();$('[name=exam_type] option[value=1]').hide();$('[name=exam_type] option[value=5]').hide();$('[name=exam_type] option[value=4]').hide();if(subject<20)
{if(cls==9)
{$('[name=exam_type] option[value=4]').show();}
else if(cls==12||cls==13)
{$('[name=exam_type] option[value=5]').show();}}
if((subject==2)&&((cls==3||cls==4||cls==5)))
{$("[name=exam_type] option[value='0']").hide();}
else
{$("[name=exam_type] option[value='0']").show();}
if(((subject==2)&&(cls==3||cls==4||cls==5))||((subject==1||subject==6)&&(cls==4||cls==5)))
{$("[name=exam_type] option[value='6']").show();$("[name=exam_type] option[value='7']").show();}
else
{$("[name=exam_type] option[value='6']").hide();$("[name=exam_type] option[value='7']").hide();}}
$('[name=class]').change(function(){var cls=$(this).val();var subject=$('[name=subject]').val();if(cls>=1&&cls<=12){$('[name="subject"]').removeAttr('disabled');$('[name=subject]').val('-1');get_subject(cls);}else{$('[name="subject"]').attr('disabled','');}});$('[name=subject]').change(function(){$('[name=exam_type]').removeAttr('disabled');removeOptionType();$('.topic-group').addClass('hidden');});$('[name=exam_type]').change(function(){var subject=$('[name=subject]').val();var cls=$('[name=class]').val();var type=$('[name=exam_type]').val();if((type==1)||(type==0)){$('.topic-group').removeClass('hidden');load_topic_by(subject,cls,type);}else{$("[name='topic']").empty();$("[name='topic']").append('<option value="-1" selected style="display:none">Nội dung kiểm tra</option>');$('.topic-group').addClass('hidden');}});$('[name=level_city]').change(function(){var level=$('[name=level_city]').val();if(level>0)
{if(loading){return false;}
var ajax_url=BASE_URL+"ajax.php";var data={"act":"topic","code":"get_exam_refer_type","level":level};loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,success:function(result){loading=false;$('#loading-layer').fadeOut();$("[name='exam_refer_type']").empty();if(result.status){$("[name='exam_refer_type']").append(result.value);}}});}});$('.btn-next').click(function(){var v=parseInt($('.tab-pane.active').attr('data-value'));console.log(v+1);$('#tp-examControl ul li[data-value='+(v+1)+']').find('a').trigger('click');});$('.btn-prev').click(function(){var v=parseInt($('.tab-pane.active').attr('data-value'));console.log(v-1);$('#tp-examControl ul li[data-value='+(v-1)+']').find('a').trigger('click');});});var firstUpdate=true;function update(previewArea)
{if(firstUpdate){firstUpdate=false;}else{MathJax.Hub.Queue(['resetEquationNumbers',MathJax.InputJax.TeX]);}
MathJax.Hub.Queue(['Typeset',MathJax.Hub,previewArea]);}
var loading=false;function isNumber(evt){evt=(evt)?evt:window.event;var charCode=(evt.which)?evt.which:evt.keyCode;if(charCode>31&&(charCode<48||charCode>57)){return false;}
return true;}
function set_client_cookie(cname,cvalue,exdays){var d=new Date();d.setTime(d.getTime()+(exdays*24*60*60*1000));var expires="expires="+d.toGMTString();document.cookie=cname+"="+cvalue+"; "+expires;}
function get_client_cookie(cname){var name=cname+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1);if(c.indexOf(name)!=-1)return c.substring(name.length,c.length);}
return"";}
function load_topic_by(subject,cls,type){if(loading){return false;}
var ajax_url=BASE_URL+"ajax.php";var data={"act":"topic","code":"get_topic","s":subject,"c":cls,"t":type};loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,success:function(result){loading=false;$('#loading-layer').fadeOut();$("[name='topic']").empty();$("[name='topic']").append('<option value="-1" selected style="display:none">Nội dung kiểm tra</option>');if(result.status){$("[name='topic']").append(result.value);update($("[name='topic']").html());}}});}
function get_subject(cls){if(loading){return false;}
var ajax_url=BASE_URL+"ajax.php";var data={"act":"topic","code":"get_subject","c":cls};loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,success:function(result){loading=false;$('#loading-layer').fadeOut();$("[name='subject']").empty();$("[name='subject']").append('<option value="-1" selected style="display:none">Chọn môn</option>');if(result.status){$("[name='subject']").append(result.value);update($("[name='subject']").html());}}});}
function buy_question(){if(loading){return false;}
var eid=$('[name=eid]').val();var q=$('[name=question_type]:checked').val();var n=$('[name=number]').val();var c=$('.question-group li').length;var topic=$('[name=topic]').val();var level=$('[name=level]').val();var ajax_url=BASE_URL+"ajax.php";var data={"act":"topic","code":"buy_question","e":eid,"n":n,"c":c,"q":q,"topic":topic,"level":level};loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,success:function(result){loading=false;$('#loading-layer').fadeOut();if(result.status){$('.question-group').append(result.value.content);$('#tp-examControl ul').append(result.value.number);$('#buy_question').find('.balance').html(numeral(result.message).format('0,0'));$('#buy_question').modal('toggle');$('.dropdown-header.balance').html(numeral(result.message).format('0,0'));}else{$('.alert-message').html(result.message);}}}).done(function(){update('.card-wrapper');});}
function add_question(){if(loading){return false;}
var eid=$('[name=eid]').val();var question_type=$('[name=question_type]:checked').val();var count=$('.question-group li').length;var ajax_url=BASE_URL+"ajax.php";var data={"act":"topic","code":"add_question","e":eid,"q":question_type,"c":count};loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,success:function(result){loading=false;$('#loading-layer').fadeOut();if(result.status){$('.question-group').append(result.value.content);$('#tp-examControl ul').append(result.value.number);var count=result.value.count;$('#tp-examControl ul li[data-value='+count+']').find('a').trigger('click');var selector=".question-area";if(question_type!=-1){selector+=",.answer-item";}
initTinyMce(selector);$('[data-toggle=tooltip]').tooltip({container:'body'});}else{alert(result.message);}}});}
function invite_student(btn){if(loading){return false;}
var notif_data={from_name:$(btn).data('from-name'),from_id:$(btn).data('from-id'),to_name:$(btn).data('to-name'),to_id:$(btn).data('to-id'),object_name:$(btn).data('object-name'),object_id:$(btn).data('object-id'),type:'TEACHER_INVITE_STUDENT_TO_EXAM'};var uid=notif_data.to_id;var input=$('[name=invite_student_'+uid+']');var eid=$('[name=eid]').val();var ajax_url=BASE_URL+"ajax.php";var data={"act":"topic","code":"invite_student","u":uid,"e":eid};loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,success:function(result){loading=false;$('#loading-layer').fadeOut();if(result.status){$('.noti-confirm').html('Bạn đã mời học sinh '+result.value+' làm đề thành công.').addClass('text-primary').removeClass('text-danger');window.notif.send(notif_data);}else{alert(result.message);}}});}
function invite_class(cid){if(loading){return false;}
var input=$('[name=invite_class_'+cid+']');if(input.is(":checked")){var eid=$('[name=eid]').val();var ajax_url=BASE_URL+"ajax.php";var data={"act":"topic","code":"invite_class","c":cid,"e":eid};loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,success:function(result){loading=false;$('#loading-layer').fadeOut();if(result.status){$('.noti-confirm').html('Bạn đã mời lớp '+result.value+' làm đề thành công.').addClass('text-primary').removeClass('text-danger');}else{alert(result.message);}}});}else{remove_class(cid);}}
function remove_student(uid){if(loading){return false;}
loading=true;$('#loading-layer').fadeIn();var eid=$('[name=eid]').val();var ajax_url=BASE_URL+"ajax.php";var data={"act":"topic","code":"remove_student","u":uid,"e":eid};loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,success:function(result){loading=false;$('#loading-layer').fadeOut();if(result.status){$('.noti-confirm').html('Bạn đã bỏ học sinh '+result.value+' làm đề thành công.').addClass('text-danger').removeClass('text-primary');}else{alert(result.message);}}});}
function remove_class(cid){if(loading){return false;}
loading=true;$('#loading-layer').fadeIn();var eid=$('[name=eid]').val();var ajax_url=BASE_URL+"ajax.php";var data={"act":"topic","code":"remove_class","c":cid,"e":eid};loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,success:function(result){loading=false;$('#loading-layer').fadeOut();if(result.status){$('.noti-confirm').html('Bạn đã bỏ lớp '+result.value+' làm đề thành công.').addClass('text-danger').removeClass('text-primary');}else{alert(result.message);}}});}
function save_question(qid){if(loading){return false;}
loading=true;$('#loading-layer').fadeIn();tinyMCE.triggerSave(true,true);var form=$('form[name=question_add_'+qid+']');var data=new FormData(form[0]);var eid=$('[name=eid]').val();var q=$('#cau'+qid+' [name=q]').val();data.append('act','topic');data.append('code','save_question');data.append('e',eid);var ajax_url=BASE_URL+"ajax.php";loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,async:false,cache:false,contentType:false,processData:false,success:function(result){loading=false;$('#loading-layer').fadeOut();if(result.status){form.find('.btn-save-'+qid).remove();form.find('[name=qid]').val(result.value);form.find('.btn-update-'+qid).removeClass('hidden');$('#tp-examControl ul li[data-value='+qid+']').addClass('done');}else{showNotification('save-question','Thông báo',result.message);}}});}
function update_question(qid){if(loading){return false;}
loading=true;$('#loading-layer').fadeIn();var form=$('form[name=question_add_'+qid+']');var data=new FormData(form[0]);data.append('act','topic');data.append('code','update_question');var ajax_url=BASE_URL+"ajax.php";loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,async:false,cache:false,contentType:false,processData:false,success:function(result){loading=false;$('#loading-layer').fadeOut();if(result.status){form.find('[name=qid]').val(result.value);$('#tp-examControl ul li[data-value='+qid+']').addClass('done');}else{alert(result.message);}}});}
function remove_question(qid){var r=confirm('Bạn có muốn bỏ câu hỏi này?');if(r==true){if(loading){return false;}
loading=true;$('#loading-layer').fadeIn();var form=$('form[name=question_add_'+qid+']');var q=form.find('[name=qid]').val();if(parseInt(q)>0){var ajax_url=BASE_URL+"ajax.php";var data={"act":"topic","code":"remove_question","q":q};loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,success:function(result){loading=false;$('#loading-layer').fadeOut();if(result.status){location.href=window.location;}else{alert(result.message);}}});}else{loading=false;$('#loading-layer').fadeOut();$('form[name=question_add_'+qid+']').parent('li').remove();$('#tp-examControl ul li[data-value='+qid+']').remove();}}}
function reply_question(qid){if(loading){return false;}
loading=true;$('#loading-layer').fadeIn();var form=$('form[name=question_reply_'+qid+']');var data=new FormData(form[0]);var eid=$('[name=eid]').val();data.append('act','topic');data.append('code','reply_question');data.append('e',eid);var q_type=form.find('[name=q_type]').val();var ajax_url=BASE_URL+"ajax.php";if(q_type==-1){data.append('answer',tinyMCE.get('answer_'+qid).getContent());}
$.ajax({type:'POST',url:ajax_url,data:data,async:false,cache:false,contentType:false,processData:false,success:function(result){loading=false;$('#loading-layer').fadeOut();if(result.status){var count_finish=result.message;$('.count-finish').html((count_finish));if(result.value){form.find('.reply_answer_media').html('<img src="'+STREAM_URL+result.value+'" style="max-width: 100%">');}
$('a[href="#cau'+qid+'"]').parent('li').addClass('done');}else{alert(result.message);}}});}
function submit_exam(eid,type){if(loading){return false;}
if(type){loading=true;$('#loading-layer').fadeIn();var ajax_url=BASE_URL+"ajax.php";var data='&act=topic&code=submit_exam&e='+eid;loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,success:function(result){loading=false;$('#loading-layer').fadeOut();if(result.status){location.href=BASE_URL+'room.html?cmd=result&id='+result.value;}else{alert(result.message);}}});}}
function reset_exam(eid){if(loading){return false;}
loading=true;$('#loading-layer').fadeIn();var eid=$('[name=eid]').val();var ajax_url=BASE_URL+"ajax.php";var data='&act=topic&code=reset_exam&e='+eid;loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,success:function(result){loading=false;$('#loading-layer').fadeOut();if(result.status){window.location=BASE_URL+'room.html?id='+eid;}else{alert(result.message);}}});}
function create_exam(){if(loading){return false;}
loading=true;$('#loading-layer').fadeIn();var form=$('form[name=create_exam]');var ajax_url=BASE_URL+"ajax.php";var data=form.serialize()+'&act=topic&code=create_exam';loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,success:function(result){loading=false;$('#loading-layer').fadeOut();if(result.status){$('.btn-create-exam').hide();window.location=result.value;}else{alert(result.message);}}});}
function register_exam(eid){if(loading){return false;}
loading=true;$('#loading-layer').fadeIn();var ajax_url=BASE_URL+"ajax.php";var data='&act=topic&code=register_exam&e='+eid;loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,success:function(result){loading=false;$('#loading-layer').fadeOut();if(result.status){$('.btn-register-exam-'+eid).addClass('hidden');$('.btn-pending-exam-'+eid).removeClass('hidden');showNotification('registerExam','Thông báo','Đăng ký thi thành công');}else{showNotification('registerExam','Thông báo',result.message);}}});}
function remove_reg_exam(eid){if(loading){return false;}
loading=true;$('#loading-layer').fadeIn();var ajax_url=BASE_URL+"ajax.php";var data='&act=topic&code=remove_reg_exam&e='+eid;loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,success:function(result){loading=false;$('#loading-layer').fadeOut();if(result.status){$('.btn-register-exam-'+eid).removeClass('hidden');$('.btn-pending-exam-'+eid).addClass('hidden');}else{alert(result.message);}}});}
function approve_exam(uid,type,eid){if(loading){return false;}
loading=true;$('#loading-layer').fadeIn();if(eid==undefined){eid=$('[name=eid]').val();}
var ajax_url=BASE_URL+"ajax.php";var data='&act=topic&code=approve_exam&u='+uid+'&e='+eid+'&t='+type;loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,success:function(result){loading=false;$('#loading-layer').fadeOut();if(result.status){$('.user-list-student').append(result.value);$('.user-list-pending').find('[name=pending_'+uid+']').remove();$(this).parent('li').remove();}else{alert(result.message);}}});}
function register_comment(){if(loading){return false;}
var tids=$('[name=list_reg_comment]').val();var elid=$('[name=elid]').val();loading=true;$('#loading-layer').fadeIn();var ajax_url=BASE_URL+"ajax.php";var data='&act=topic&code=register_comment&el='+elid+'&tids='+btoa(tids);loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,success:function(result){loading=false;$('#loading-layer').fadeOut();$('.noti-confirm').html(result.message);if(result.status){location.reload();}}});}
function remove_reg_comment(tid){if(loading){return false;}
var elid=$('[name=elid]').val();loading=true;$('#loading-layer').fadeIn();var ajax_url=BASE_URL+"ajax.php";var data='&act=topic&code=remove_reg_comment&el='+elid+'&tid='+tid;loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,success:function(result){loading=false;$('#loading-layer').fadeOut();if(result.status){$('.noti-confirm').html('Bạn đã bỏ xin nhận xét của thầy '+result.value+' thành công.').addClass('text-danger').removeClass('text-primary');}else{alert(result.message);}}});}
function marking_question(elid,qid){if(loading){return false;}
loading=true;$('#loading-layer').fadeIn();var point=$('[name=point_'+qid+']').val();var ajax_url=BASE_URL+"ajax.php";var data='&act=topic&code=marking_question&el='+elid+'&qid='+qid+'&p='+point;loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,success:function(result){loading=false;$('#loading-layer').fadeOut();if(result.status){location.reload();}else{alert(result.message);}}});}
function follow(uid,fid,type){if(loading){return false;}
loading=true;$('#loading-layer').fadeIn();var ajax_url=URL_IDS+"ajax.php";var data='&act=follow&uid='+uid+'&fid='+fid;var flw=parseInt($('.num-follow-'+uid).html());loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,success:function(result){loading=false;$('#loading-layer').fadeOut();if(result==1){$('.num-follow-'+uid).html(flw+1);$('#follow_'+uid).addClass('grey-btn').html('Đang quan tâm');}else if(result==2){$('.num-follow-'+uid).html(flw-1);$('#follow_'+uid).removeClass('grey-btn').addClass('green-btn').html('Quan tâm');}}});}
function sortMaker(id){var sortInput=$('#sort_order_'+id);var list=$('#sortable-list-'+id);var fnSubmit=function(){var sortOrder=[];list.children('li').each(function(){sortOrder.push($(this).attr('data-value'));});sortInput.val(sortOrder.join(','));console.log(sortInput.val());};list.children('li').each(function(){var li=$(this);li.data('id',li.attr('title')).attr('title','');});list.sortable({opacity:0.7,placeholder:"sortable-placeholder",forcePlaceholderSize:true,zIndex:99999,update:function(){fnSubmit();}});}
function checkPayment(type,eid,notif,exam_id)
{if(eid>0)
{checkExamPayment(eid,0,0,0,0,notif);}
else if(type==0)
{var e_class=$("[name = 'class']").val(),e_subject=$("[name = 'subject']").val(),e_type=$("[name = 'exam_type_"+exam_id+"']").val(),e_topic=$("[name = 'topic_"+exam_id+"']").val();data+='&type='+type+'&class='+e_class+'&subject='+e_subject+'&exam_type='+e_type+'&topic='+e_topic;checkExamPayment(0,e_type,e_class,e_subject,e_topic,notif);}}
function checkExamPayment(eid,e_type,e_class,e_subject,e_topic,notif,purpose)
{if(loading)
{return false;}
loading=true;$('#loading-layer').fadeIn();var ajax_url=BASE_URL+"ajax.php";var data='&act=topic&code=check_payment';if(eid>0)
{data+='&eid='+eid;}
else
{data+='&class='+e_class+'&subject='+e_subject+'&exam_type='+e_type+'&topic='+e_topic;}
if(typeof(purpose)!=='undefined'&&purpose=='print'){data+='&purpose=print';}
loading=true;$('#loading-layer').fadeIn();if(notif)
{var notif_data={from_id:$(notif).data('from-id'),from_name:$(notif).data('from-name'),to_id:$(notif).data('to-id'),to_name:$(notif).data('to-name'),object_id:$(notif).data('object-id'),object_name:$(notif).data('object-name'),type:'STUDENT_REQUEST_TO_EXAM'}}
$.ajax({type:'POST',url:ajax_url,data:data,success:function(result)
{loading=false;$('#loading-layer').fadeOut();if(result.status)
{$('.e_price').html(result.value.price);$('.u_balance').html(result.value.balance);if(notif_data)
{$('.exam_btn_pay_confirm').attr('onclick','payToExam('+eid+', '+e_type+', '+e_class+', '+e_subject+', '+e_topic+', '+JSON.stringify(notif_data)+', "'+purpose+'")');$('.exam_btn_pay_free').attr('onclick','payFreeToExam('+eid+', '+e_type+', '+e_class+', '+e_subject+', '+e_topic+', '+JSON.stringify(notif_data)+', "'+purpose+'")');}
else
{$('.exam_btn_pay_confirm').attr('onclick','payToExam('+eid+', '+e_type+', '+e_class+', '+e_subject+', '+e_topic+', false, "'+purpose+'")');$('.exam_btn_pay_free').attr('onclick','payFreeToExam('+eid+', '+e_type+', '+e_class+', '+e_subject+', '+e_topic+', false, "'+purpose+'")');}
var modal_id=(result.value.status==0)?'needPaymentModal':'pricePaymentModal';if(typeof(purpose)!=='undefined'&&purpose=='print'){$('#'+modal_id+' #myModalLabel').html("Phí in đề thi");if(typeof(result.value.approved)!=='undefined'&&result.value.approved==1){$('.exam_btn_pay_free').css('display','inline');$('.exam_btn_pay_free').html('In thử');}else{$('.exam_btn_pay_free').css('display','none');}
$('h5.buy-exam-label span').html('Phí in đề thi');$('#'+modal_id+' .guide-link').html('<i class="fa fa-question-circle-o" aria-hidden="true" style="font-size: 24px; vertical-align: sub;"></i> Hướng dẫn in đề thi');$('#'+modal_id+' .guide-link').attr('href',URL_BIGS+'huong-dan-in-de-thi-thu-thpt-quoc-gia-tu-bigschool');}else{$('#'+modal_id+' #myModalLabel').html("Phí vào thi");$('.exam_btn_pay_free').css('display','inline');$('.exam_btn_pay_free').html('Thi thử');$('h5.buy-exam-label span').html('Phí vào thi');$('#'+modal_id+' .guide-link').html('<i class="fa fa-question-circle-o" aria-hidden="true" style="font-size: 24px; vertical-align: sub;"></i> Hướng dẫn làm bài');$('#'+modal_id+' .guide-link').attr('href',URL_BIGS+'huong-dan-lam-de-thi-khao-thi-doc-lap#tips');}
$('.e_price_exchange').html('('+(result.value.price*100)+' VND)');$('#'+modal_id).modal();}
else
{showNotification('checkPaymentExam','Thông báo',result.message);}}});}
function payExam(type,eid,notif_data,exam_id)
{if(eid>0)
{data+='&eid='+eid;payToExam(eid,0,0,0,0,notif);}
elseif(type==0)
{var e_class=$("[name = 'class']").val(),e_subject=$("[name = 'subject']").val(),e_type=$("[name = 'exam_type_"+exam_id+"']").val(),e_topic=$("[name = 'topic_"+exam_id+"']").val();payToExam(0,e_type,e_class,e_subject,e_topic,notif);}}
function payToExam(eid,e_type,e_class,e_subject,e_topic,notif_data,purpose)
{if(loading)
{return false;}
loading=true;$('#loading-layer').fadeIn();var ajax_url=BASE_URL+"ajax.php";var data='&act=topic&code=pay_exam';if(eid>0)
{data+='&eid='+eid;}
else
{data+='&class='+e_class+'&subject='+e_subject+'&exam_type='+e_type+'&topic='+e_topic;}
if(typeof(purpose)!=='undefined'&&purpose=='print'){data+='&purpose=print';}
$.ajax({type:'POST',url:ajax_url,data:data,success:function(result)
{loading=false;$('#loading-layer').fadeOut();if(result.message!='')
{$('#needPaymentModal').modal('hide');$('#pricePaymentModal').modal('hide');showNotification('exam_err','Thông báo',result.message);}
if(result.status)
{if(notif_data)
{window.notif.send(notif_data);}
if(result.message!='')
{setTimeout(function(){window.location=result.value;},3000);}
else
{window.location=result.value;}}}});}
function payExamFree(type,eid,notif_data,exam_id)
{if(loading)
{return false;}
loading=true;$('#loading-layer').fadeIn();var ajax_url=BASE_URL+"ajax.php";if(eid>0)
{payFreeToExam(eid,e_type,e_class,e_subject,e_topic,notif)}
elseif(type==0)
{var e_class=$("[name = 'class']").val(),e_subject=$("[name = 'subject']").val(),e_type=$("[name = 'exam_type_"+exam_id+"']").val(),e_topic=$("[name = 'topic_"+exam_id+"']").val();payFreeToExam(eid,e_type,e_class,e_subject,e_topic,notif)}}
function payFreeToExam(eid,e_type,e_class,e_subject,e_topic,notif_data,purpose)
{if(loading)
{return false;}
loading=true;$('#loading-layer').fadeIn();var ajax_url=BASE_URL+"ajax.php";var data='&act=topic&code=free_exam';if(eid>0)
{data+='&eid='+eid;}
else
{data+='&class='+e_class+'&subject='+e_subject+'&exam_type='+e_type+'&topic='+e_topic;}
if(typeof(purpose)!=='undefined'&&purpose=='print'){data+='&purpose=print';}
$.ajax({type:'POST',url:ajax_url,data:data,success:function(result)
{loading=false;$('#loading-layer').fadeOut();if(result.message!='')
{$('#needPaymentModal').modal('hide');$('#pricePaymentModal').modal('hide');showNotification('exam_err','Thông báo',result.message);}
if(result.status)
{if(notif_data)
{window.notif.send(notif_data);}
if(result.message!='')
{setTimeout(function(){window.location=result.value;},3000);}
else
{window.location=result.value;}}}});}
function save_comment(eid){if(loading){return false;}
var comment=$('[name=comment_'+eid+']').val();loading=true;$('#loading-layer').fadeIn();var ajax_url=BASE_URL+"ajax.php";var data={act:'comment',code:'save_comment',eid:eid,comment:comment,}
loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,success:function(result){loading=false;$('#loading-layer').fadeOut();if(result.status){location.reload();}else{alert(result.message);}}});}
function checkExamSelective(e_class,e_subject,e_type,topic_id)
{var message='';if(e_class<0&&e_class>13)
{message='Bạn chưa chọn lớp.';}
else if(e_subject<0)
{message='Bạn chưa chọn môn.';}
else if(e_type<0)
{message='Bạn chưa chọn loại đề thi.';}
else if(topic_id<0&&(e_type==0||e_type==1))
{message='Bạn chưa chọn nội dung kiểm tra.';}
else
{checkExamPayment(0,e_type,e_class,e_subject,topic_id);}
if(message!='')
{showNotification('selectiveExam','Thông báo',message);}}
function validateBeforePrintExam(options){var purpose='print';checkExamPayment(0,options.exam_type,options.class,options.subject,options.topic_id,false,purpose);}
function checkSelective(exam_id)
{var get_class=$('[name="class"]').val(),get_subject=$('[name="subject"]').val(),get_type=$('[name="exam_type_'+exam_id+'"]').val(),get_topic=$('[name="topic_'+exam_id+'"]').val(),has_error=false,message='';if(get_class<0)
{has_error=true;message='Bạn chưa chọn lớp.';}
if(get_class>0&&get_subject<0)
{has_error=true;message='Bạn chưa chọn môn.';}
if(get_class>0&&get_subject>0&&get_type<0)
{has_error=true;message='Bạn chưa chọn loại đề thi.';}
if(get_class>0&&get_subject>0&&get_type>=0)
{if(get_topic<0&&(get_type==0||get_type==1))
{has_error=true;message='Bạn chưa chọn nội dung kiểm tra.';}}
if(has_error)
{showNotification('selectiveExam','Thông báo',message);}
else
{checkPayment(0,0,0,exam_id);}}
function load_pick_question(begin,limit){if(loading){return false;}
var eid=$('[name=eid]').val();var c=$('.question-group li').length;var txtSearch=$('[name=txtSearch]').val();var ajax_url=BASE_URL+"ajax.php";var data={"act":"topic","code":"load_pick_question","txt":txtSearch,"e":eid,"c":c,"b":begin,"l":limit};loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,success:function(result){loading=false;$('#loading-layer').fadeOut();if(result.status){if(begin==0){$('.list-question-member').html(result.value);}else{$('.list-question-member').append(result.value);}
BEGIN=result.message;console.log(BEGIN);}else{if(begin==0){$('.list-question-member').html('<li>'+result.message+'</li>');}else{$('.more-question').remove();}}}}).done(function(){update('.card-wrapper');});}
function save_question_picked(qid){if(loading){return false;}
loading=true;$('#loading-layer').fadeIn();var cf=confirm('Bạn chọn câu hỏi id:'+qid+' này?');if(cf==true){var c=$('.question-group li').length;var eid=$('[name=eid]').val();var ajax_url=BASE_URL+"ajax.php";var data={"act":"topic","code":"save_question_picked","qid":qid,"e":eid,"c":c};loading=true;$('#loading-layer').fadeIn();$.ajax({type:'POST',url:ajax_url,data:data,success:function(result){loading=false;$('#loading-layer').fadeOut();if(result.status){location.href=window.location;}else{showNotification('','Thông báo',result.message);}}}).done(function(){update('.question-group');});}}
;!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("jquery")):t(jQuery)}(function(t){var e=-1,o=-1,n=function(t){return parseFloat(t)||0},a=function(e){var o=1,a=t(e),i=null,r=[];return a.each(function(){var e=t(this),a=e.offset().top-n(e.css("margin-top")),s=r.length>0?r[r.length-1]:null;null===s?r.push(e):Math.floor(Math.abs(i-a))<=o?r[r.length-1]=s.add(e):r.push(e),i=a}),r},i=function(e){var o={
byRow:!0,property:"height",target:null,remove:!1};return"object"==typeof e?t.extend(o,e):("boolean"==typeof e?o.byRow=e:"remove"===e&&(o.remove=!0),o)},r=t.fn.matchHeight=function(e){var o=i(e);if(o.remove){var n=this;return this.css(o.property,""),t.each(r._groups,function(t,e){e.elements=e.elements.not(n)}),this}return this.length<=1&&!o.target?this:(r._groups.push({elements:this,options:o}),r._apply(this,o),this)};r.version="0.7.2",r._groups=[],r._throttle=80,r._maintainScroll=!1,r._beforeUpdate=null,
r._afterUpdate=null,r._rows=a,r._parse=n,r._parseOptions=i,r._apply=function(e,o){var s=i(o),h=t(e),l=[h],c=t(window).scrollTop(),p=t("html").outerHeight(!0),u=h.parents().filter(":hidden");return u.each(function(){var e=t(this);e.data("style-cache",e.attr("style"))}),u.css("display","block"),s.byRow&&!s.target&&(h.each(function(){var e=t(this),o=e.css("display");"inline-block"!==o&&"flex"!==o&&"inline-flex"!==o&&(o="block"),e.data("style-cache",e.attr("style")),e.css({display:o,"padding-top":"0",
"padding-bottom":"0","margin-top":"0","margin-bottom":"0","border-top-width":"0","border-bottom-width":"0",height:"100px",overflow:"hidden"})}),l=a(h),h.each(function(){var e=t(this);e.attr("style",e.data("style-cache")||"")})),t.each(l,function(e,o){var a=t(o),i=0;if(s.target)i=s.target.outerHeight(!1);else{if(s.byRow&&a.length<=1)return void a.css(s.property,"");a.each(function(){var e=t(this),o=e.attr("style"),n=e.css("display");"inline-block"!==n&&"flex"!==n&&"inline-flex"!==n&&(n="block");var a={
display:n};a[s.property]="",e.css(a),e.outerHeight(!1)>i&&(i=e.outerHeight(!1)),o?e.attr("style",o):e.css("display","")})}a.each(function(){var e=t(this),o=0;s.target&&e.is(s.target)||("border-box"!==e.css("box-sizing")&&(o+=n(e.css("border-top-width"))+n(e.css("border-bottom-width")),o+=n(e.css("padding-top"))+n(e.css("padding-bottom"))),e.css(s.property,i-o+"px"))})}),u.each(function(){var e=t(this);e.attr("style",e.data("style-cache")||null)}),r._maintainScroll&&t(window).scrollTop(c/p*t("html").outerHeight(!0)),
this},r._applyDataApi=function(){var e={};t("[data-match-height], [data-mh]").each(function(){var o=t(this),n=o.attr("data-mh")||o.attr("data-match-height");n in e?e[n]=e[n].add(o):e[n]=o}),t.each(e,function(){this.matchHeight(!0)})};var s=function(e){r._beforeUpdate&&r._beforeUpdate(e,r._groups),t.each(r._groups,function(){r._apply(this.elements,this.options)}),r._afterUpdate&&r._afterUpdate(e,r._groups)};r._update=function(n,a){if(a&&"resize"===a.type){var i=t(window).width();if(i===e)return;e=i;
}n?o===-1&&(o=setTimeout(function(){s(a),o=-1},r._throttle)):s(a)},t(r._applyDataApi);var h=t.fn.on?"on":"bind";t(window)[h]("load",function(t){r._update(!1,t)}),t(window)[h]("resize orientationchange",function(t){r._update(!0,t)})});